#! /bin/sh /usr/share/dpatch/dpatch-run
## 04_static_install_target.dpatch by  <david@evans>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
Index: ATLAS/CONFIG/src/Makefile
===================================================================
--- ATLAS.orig/CONFIG/src/Makefile	2011-05-14 19:33:24.000000000 +0200
+++ ATLAS/CONFIG/src/Makefile	2012-07-16 15:34:10.000000000 +0200
@@ -366,7 +366,7 @@
 	chmod 0755 $(LIBINSTdir)
 install : $(INCINSTdir) $(LIBINSTdir) $(INCINSTdir)/atlas
 	$(MAKE) -f Make.top install_inc INSTdir=$(INCINSTdir) 
-	$(MAKE) -f Make.top install_lib INSTdir=$(LIBINSTdir)
+	$(MAKE) -f Make.top install_static_lib INSTdir=$(LIBINSTdir)
 
 confclean:
 	rm -f *core* *.o config?.out
Index: ATLAS/CONFIG/src/SpewMakeInc.c
===================================================================
--- ATLAS.orig/CONFIG/src/SpewMakeInc.c	2012-07-16 15:34:02.000000000 +0200
+++ ATLAS/CONFIG/src/SpewMakeInc.c	2012-07-16 15:34:10.000000000 +0200
@@ -539,6 +539,9 @@
    fprintf(fpout, "   LAPACKlib = $(LIBdir)/liblapack_atlas.a\n");
    fprintf(fpout, "   TESTlib = $(LIBdir)/libtstatlas.a\n\n");
 
+   fprintf(fpout, "   FULLBLASlib = $(LIBdir)/atlas/libblas.a\n");
+   fprintf(fpout, "   FULLLAPACKlib = $(LIBdir)/atlas/liblapack.a\n");
+
    fprintf(fpout, "#  -------------------------------------------\n");
    fprintf(fpout, "#  Upper bound on largest cache size, in bytes\n");
    fprintf(fpout, "#  -------------------------------------------\n");
Index: ATLAS/Make.top
===================================================================
--- ATLAS.orig/Make.top	2012-07-16 15:34:07.000000000 +0200
+++ ATLAS/Make.top	2012-07-16 15:34:10.000000000 +0200
@@ -15,6 +15,11 @@
 build:
 	cd bin/ ; $(MAKE) xatlas_build
 	cd bin/ ; ./xatlas_build $(INSTFLAGS)
+	cd lib/ ; $(MAKE) atlas/libblas.a
+	cd lib/ ; $(MAKE) atlas/liblapack.a
+	cd lib/ ; $(MAKE) shared
+	cd lib/ ; $(MAKE) fullshared
+
 time: 
 	./xatlbench -dc $(BLDdir)/bin/INSTALL_LOG -dp $(BLDdir)/ARCHS/$(ARCH)
 C_sanity_test:
@@ -290,12 +295,16 @@
 	chmod 0644 $(INSTdir)/cblas.h $(INSTdir)/clapack.h
 	cp $(INCAdir)/* $(INSTdir)/atlas/.
 	- chmod 0644 $(INSTdir)/atlas/*
-install_lib:
+
+install_static_lib:
 	cp $(LIBdir)/libatlas.a $(INSTdir)/.
 	cp $(LIBdir)/libcblas.a $(INSTdir)/.
 	cp $(LIBdir)/liblapack_atlas.a $(INSTdir)/.
+	cp $(LIBdir)/atlas/libblas.a $(INSTdir)/atlas/.
+	cp $(LIBdir)/atlas/liblapack.a $(INSTdir)/atlas/.
 	chmod 0644 $(INSTdir)/libatlas.a  $(INSTdir)/liblapack_atlas.a \
-                   $(INSTdir)/libcblas.a 
+                   $(INSTdir)/libcblas.a $(INSTdir)/atlas/libblas.a \
+		   $(INSTdir)/atlas/liblapack.a 
 	- cp $(LIBdir)/libf77blas.a $(INSTdir)/.
 	- chmod 0644 $(INSTdir)/libf77blas.a
 	- cp $(LIBdir)/libptcblas.a $(INSTdir)/.
